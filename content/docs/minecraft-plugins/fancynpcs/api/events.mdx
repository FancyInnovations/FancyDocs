---
title: Events
description: Listening to NPC events
---

FancyNPCs provides a comprehensive event system that allows you to react to NPC-related actions and state changes.

## Listening to events

All FancyNPCs events extend Bukkit's `Event` class and can be listened to using standard Bukkit event handlers:

```java
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;

public class NpcEventListener implements Listener {

    @EventHandler
    public void onNpcInteract(NpcInteractEvent event) {
        // Handle the event
    }
}
```

Register your listener in your plugin:

```java
@Override
public void onEnable() {
    getServer().getPluginManager().registerEvents(new NpcEventListener(), this);
}
```

## Available events

### NpcCreateEvent

Fired when an NPC is created.

```java
import de.oliver.fancynpcs.api.events.NpcCreateEvent;

@EventHandler
public void onNpcCreate(NpcCreateEvent event) {
    Npc npc = event.getNpc();
    Player creator = event.getCreator(); // May be null

    plugin.getLogger().info("NPC created: " + npc.getData().getName());
}
```

### NpcRemoveEvent

Fired when an NPC is removed.

```java
import de.oliver.fancynpcs.api.events.NpcRemoveEvent;

@EventHandler
public void onNpcRemove(NpcRemoveEvent event) {
    Npc npc = event.getNpc();

    plugin.getLogger().info("NPC removed: " + npc.getData().getName());
}
```

### NpcModifyEvent

Fired when an NPC's properties are modified.

```java
import de.oliver.fancynpcs.api.events.NpcModifyEvent;

@EventHandler
public void onNpcModify(NpcModifyEvent event) {
    Npc npc = event.getNpc();
    Player modifier = event.getModifier(); // May be null

    plugin.getLogger().info("NPC modified: " + npc.getData().getName());
}
```

### NpcSpawnEvent

Fired when an NPC is spawned for a specific player.

```java
import de.oliver.fancynpcs.api.events.NpcSpawnEvent;

@EventHandler
public void onNpcSpawn(NpcSpawnEvent event) {
    Npc npc = event.getNpc();
    Player player = event.getPlayer();

    player.sendMessage("NPC spawned: " + npc.getData().getDisplayName());
}
```

### NpcInteractEvent

Fired when a player interacts with an NPC. **This event is cancellable.**

```java
import de.oliver.fancynpcs.api.events.NpcInteractEvent;
import de.oliver.fancynpcs.api.actions.ActionTrigger;

@EventHandler
public void onNpcInteract(NpcInteractEvent event) {
    Npc npc = event.getNpc();
    Player player = event.getPlayer();
    ActionTrigger trigger = event.getTrigger();

    // Check what type of interaction
    if (trigger == ActionTrigger.RIGHT_CLICK) {
        player.sendMessage("You right-clicked " + npc.getData().getName());
    }

    // Cancel the interaction
    if (!player.hasPermission("npcs.interact")) {
        event.setCancelled(true);
        player.sendMessage("You don't have permission!");
    }
}
```

**Properties:**
- `getNpc()` - The NPC being interacted with
- `getPlayer()` - The player who interacted
- `getTrigger()` - The type of interaction (LEFT_CLICK, RIGHT_CLICK, etc.)
- `getOnClick()` - Custom click handler (may be null)
- `getActions()` - List of actions to execute
- `isCancelled()` / `setCancelled(boolean)` - Cancel the interaction

### NpcsLoadedEvent

Fired when all NPCs have been loaded from disk.

```java
import de.oliver.fancynpcs.api.events.NpcsLoadedEvent;

@EventHandler
public void onNpcsLoaded(NpcsLoadedEvent event) {
    plugin.getLogger().info("All NPCs have been loaded!");

    // Safe to register custom NPCs now
    registerCustomNpcs();
}
```

<Callout>
    This is the safest time to programmatically create and register NPCs, as the NPC system is fully initialized.
</Callout>

### NpcStartLookingEvent

Fired when an NPC starts looking at a player.

```java
import de.oliver.fancynpcs.api.events.NpcStartLookingEvent;

@EventHandler
public void onNpcStartLooking(NpcStartLookingEvent event) {
    Npc npc = event.getNpc();
    Player player = event.getPlayer();

    // NPC is now looking at the player
}
```

### NpcStopLookingEvent

Fired when an NPC stops looking at a player.

```java
import de.oliver.fancynpcs.api.events.NpcStopLookingEvent;

@EventHandler
public void onNpcStopLooking(NpcStopLookingEvent event) {
    Npc npc = event.getNpc();
    Player player = event.getPlayer();

    // NPC stopped looking at the player
}
```

### SkinGeneratedEvent

Fired when a skin finishes loading asynchronously.

```java
import de.oliver.fancynpcs.api.events.SkinGeneratedEvent;

@EventHandler
public void onSkinGenerated(SkinGeneratedEvent event) {
    String identifier = event.getIdentifier();
    SkinData skinData = event.getSkinData();

    plugin.getLogger().info("Skin loaded: " + identifier);

    // Apply to waiting NPCs
    applyLoadedSkin(identifier, skinData);
}
```

## Complete examples

### Example: Preventing interactions based on permission

```java
@EventHandler
public void onNpcInteract(NpcInteractEvent event) {
    Npc npc = event.getNpc();
    Player player = event.getPlayer();

    // Check if NPC requires permission
    String npcName = npc.getData().getName();
    String permission = "myplugin.npc." + npcName;

    if (!player.hasPermission(permission)) {
        event.setCancelled(true);
        player.sendMessage("§cYou don't have permission to interact with this NPC!");
        return;
    }

    // Log the interaction
    plugin.getLogger().info(player.getName() + " interacted with " + npcName);
}
```

### Example: Cooldown system

```java
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

public class NpcCooldownListener implements Listener {

    private final Map<UUID, Long> cooldowns = new HashMap<>();
    private final long COOLDOWN_MS = 5000; // 5 seconds

    @EventHandler
    public void onNpcInteract(NpcInteractEvent event) {
        Player player = event.getPlayer();
        UUID playerId = player.getUniqueId();
        long now = System.currentTimeMillis();

        // Check cooldown
        if (cooldowns.containsKey(playerId)) {
            long lastInteract = cooldowns.get(playerId);
            long timeLeft = COOLDOWN_MS - (now - lastInteract);

            if (timeLeft > 0) {
                event.setCancelled(true);
                player.sendMessage("§cPlease wait " + (timeLeft / 1000) + " seconds!");
                return;
            }
        }

        // Update cooldown
        cooldowns.put(playerId, now);
    }
}
```

### Example: Custom NPC creation workflow

```java
public class NpcCreationListener implements Listener {

    @EventHandler
    public void onNpcsLoaded(NpcsLoadedEvent event) {
        // Create NPCs after system is ready
        createSpawnNpcs();
    }

    @EventHandler
    public void onNpcCreate(NpcCreateEvent event) {
        Npc npc = event.getNpc();

        // Set default properties for all new NPCs
        NpcData data = npc.getData();
        data.setCollidable(false);
        data.setVisibilityDistance(50);

        plugin.getLogger().info("Applied default settings to new NPC");
    }

    private void createSpawnNpcs() {
        // Get spawn location
        World world = Bukkit.getWorld("world");
        Location spawn = new Location(world, 0, 64, 0);

        // Create welcome NPC
        NpcData data = new NpcData("spawn_welcome", null, spawn);
        data.setDisplayName("<rainbow>Welcome!</rainbow>");
        data.setSkin("MHF_Villager");

        Npc npc = FancyNpcsPlugin.get().getNpcAdapter().apply(data);
        FancyNpcsPlugin.get().getNpcManager().registerNpc(npc);

        npc.create();
        npc.spawnForAll();
    }
}
```

### Example: Track player interactions

```java
public class InteractionTracker implements Listener {

    private final Map<String, Integer> interactionCounts = new HashMap<>();

    @EventHandler
    public void onNpcInteract(NpcInteractEvent event) {
        String npcName = event.getNpc().getData().getName();

        // Increment counter
        interactionCounts.merge(npcName, 1, Integer::sum);

        // Log every 10 interactions
        int count = interactionCounts.get(npcName);
        if (count % 10 == 0) {
            plugin.getLogger().info(npcName + " has been interacted with "
                + count + " times!");
        }
    }

    public int getInteractionCount(String npcName) {
        return interactionCounts.getOrDefault(npcName, 0);
    }
}
```

### Example: Dynamic skin loading

```java
public class DynamicSkinLoader implements Listener {

    private final Map<String, String> pendingSkins = new HashMap<>();

    public void loadSkinForNpc(Npc npc, String skinIdentifier) {
        SkinManager skinManager = FancyNpcsPlugin.get().getSkinManager();
        SkinData skin = skinManager.getByIdentifier(skinIdentifier, SkinVariant.AUTO);

        if (skin != null) {
            // Skin available immediately
            npc.getData().setSkin(skin);
            npc.updateForAll();
        } else {
            // Skin loading asynchronously
            pendingSkins.put(skinIdentifier, npc.getData().getName());
        }
    }

    @EventHandler
    public void onSkinGenerated(SkinGeneratedEvent event) {
        String identifier = event.getIdentifier();

        if (!pendingSkins.containsKey(identifier)) {
            return;
        }

        String npcName = pendingSkins.remove(identifier);
        Npc npc = FancyNpcsPlugin.get().getNpcManager().getNpc(npcName);

        if (npc != null) {
            npc.getData().setSkin(event.getSkinData());
            npc.updateForAll();
            plugin.getLogger().info("Applied loaded skin to " + npcName);
        }
    }
}
```

## Event priority

Use event priorities to control when your handler executes:

```java
@EventHandler(priority = EventPriority.HIGHEST)
public void onNpcInteract(NpcInteractEvent event) {
    // Runs after most other handlers
}

@EventHandler(priority = EventPriority.LOWEST)
public void onNpcInteractEarly(NpcInteractEvent event) {
    // Runs before most other handlers
}
```

Priorities (in execution order):
1. `LOWEST`
2. `LOW`
3. `NORMAL` (default)
4. `HIGH`
5. `HIGHEST`
6. `MONITOR` (read-only, don't modify events here)

## Cancellable events

Only `NpcInteractEvent` is cancellable. When you cancel it:
- Actions won't execute
- Custom onClick handler won't be called
- Other plugins listening at higher priorities may still run

```java
@EventHandler(priority = EventPriority.LOW)
public void onNpcInteract(NpcInteractEvent event) {
    // Cancel early, preventing all actions
    if (someCondition) {
        event.setCancelled(true);
    }
}
```
